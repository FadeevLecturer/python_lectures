
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Работа с изображениями &#8212; Практикум по компьютерным технологиям</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my_css_rules.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Свёрточные операции" href="filters.html" />
    <link rel="prev" title="О последних лекциях" href="../python/about_12_and_so_on.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EM33EZ6FLL"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-EM33EZ6FLL');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Практикум по компьютерным технологиям</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../docs/index.html">
                    Практикум по компьютерным технологиям на языке программирования python3
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../python/about_python.html">
   О
   <code class="docutils literal notranslate">
    <span class="pre">
     python
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/getting_started.html">
   Установка
   <code class="docutils literal notranslate">
    <span class="pre">
     python
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/python_as_calculator.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Python
    </span>
   </code>
   в качестве калькулятора
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/scripts.html">
   Скрипты
   <code class="docutils literal notranslate">
    <span class="pre">
     python
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/jupyter.html">
   Блокноты.
   <code class="docutils literal notranslate">
    <span class="pre">
     Jupyter
    </span>
    <span class="pre">
     Notebooks
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/numbers_and_lists.html">
   Основные типы объектов: числа и списки
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/if_for_range.html">
   Операторы потока управления
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../homework/1.html">
   Домашнее задание №1
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/interpretability.html">
   Компилируемость vs Интерпретируемость
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/dynamic_typing.html">
   Динамическая типизация
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/type_annotations.html">
   Аннотация типов
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/mutability.html">
   Изменяемые и неизменяемый типы объектов
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/garbage_collector.html">
   Создание и удаление объектов. Сборщик мусора
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/sequences.html">
   Последовательности: списки, кортежи и строки
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../homework/2.html">
   Домашнее задание №2
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/libs_pypi_conda.html">
   Сторонние библиотеки и пакетные менеджеры
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numpy/numpy.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     NumPy
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numpy/vectorization.html">
   Векторизация
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numpy/slices.html">
   Срезы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numpy/vector_product.html">
   Умножение векторов
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numpy/logic.html">
   Логические операции
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numpy/vectorization_example.html">
   Векторизация на примере вычисления статистик
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numpy/random.html">
   Случайные числа
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numpy/homework.html">
   Домашнее задание №3
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №4
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../python/dictionaries.html">
   Словари.
   <code class="docutils literal notranslate">
    <span class="pre">
     dict
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/functions.html">
   Функции
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/filesystem.html">
   Взаимодействие с файловой системой
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/files.html">
   Работа с файлами. Сериализация:
   <code class="docutils literal notranslate">
    <span class="pre">
     json
    </span>
   </code>
   и
   <code class="docutils literal notranslate">
    <span class="pre">
     pickle
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/libraries.html">
   Построение графиков и визуализация данных
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/matplotlib.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Matplotlib
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/details.html">
   Настройка деталей графиков
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/matplotlib_animation.html">
   Анимация  в matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/homework.html">
   Домашнее задание №4
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №5
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../pandas/tables.html">
   Таблицы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pandas/pandas.html">
   Библиотека
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pandas/series.html">
   Столбцы в
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pandas/dataframe.html">
   Таблицы
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pandas/operations.html">
   Оперирование таблицами
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pandas/datetime.html">
   Дата и время
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pandas/covid19.html">
   Анализ данных о
   <code class="docutils literal notranslate">
    <span class="pre">
     COVID19
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pandas/homework.html">
   Домашнее задание №5
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №6
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../python/list_comprehensions.html">
   Основы списковых включений
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/iterators.html">
   Итераторы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/generators.html">
   Генераторы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/decorators.html">
   Декораторы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../homework/6.html">
   Домашнее задание №6
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №7
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy/scipy.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     SciPy
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy/linalg.html">
   Линейная алгебра
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy/interpolation_approx.html">
   Интерполяция и аппроксимация
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy/integration.html">
   Дифференцирование и интегрирование функций
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy/ODE.html">
   Решение ОДУ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy/optimization.html">
   Поиск минимума
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy/nonlinear_equations.html">
   Решение нелинейных уравнений
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy/signal.html">
   Обработка сигналов
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №8
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../python/custom_classes.html">
   Пользовательские классы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/inheritance.html">
   Наследование
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/polymorphism.html">
   Полиморфизм в python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/operators_overloading.html">
   Перегрузка специальных методов и операторов
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/exercises2.html">
   Практические задания
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №9
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../python/exceptions.html">
   Исключения
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/custom_exceptions.html">
   Пользовательские исключения
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/LBYL_vs_EAFP.html">
   Стратегии контроля ошибок
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Лекция №10
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/gui.html">
   Графический пользовательский интерфейс
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/basics.html">
   PySide. Основы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/event.html">
   События
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/slot_signal.html">
   Слоты и сигналы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/widgets.html">
   Виджеты и макеты
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/buttons.html">
   Кнопки
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/output.html">
   Вывод данных
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/input.html">
   Ввод данных
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/dialogs.html">
   Диалоговые окна
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qt/exercises.html">
   Практические задания
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  TBD
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../python/about_12_and_so_on.html">
   О последних лекциях
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Работа с изображениями
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="filters.html">
   Свёрточные операции
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="detection.html">
   Задача обнаружения
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine_learning/regression.html">
   Регрессия
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine_learning/classification.html">
   Классификация
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine_learning/neural_networks.html">
   Нейронный сети
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/python_scripts.html">
   Создание скриптов. Работа с IDE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/scripts_vs_modules.html">
   Скрипты и модули
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python/argparse.html">
   Аргументы командной строки
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/FadeevLecturer/python_lectures/main?urlpath=tree/notebooks/computer_vision/basics.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/FadeevLecturer/python_lectures/blob/main/notebooks/computer_vision/basics.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/FadeevLecturer/python_lectures"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/FadeevLecturer/python_lectures/issues/new?title=Issue%20on%20page%20%2Fnotebooks/computer_vision/basics.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/FadeevLecturer/python_lectures/edit/main/notebooks/computer_vision/basics.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/computer_vision/basics.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Изображения в оттенках серого
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Чтение с диска
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Яркости пикселей
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Манипуляции на формой массива
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Поворот на произвольный угол
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   Цветные изображения
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Работа с изображениями</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Изображения в оттенках серого
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Чтение с диска
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Яркости пикселей
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Манипуляции на формой массива
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Поворот на произвольный угол
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   Цветные изображения
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>Работа с изображениями<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h1>
<p id="cv-basics">Есть, пожалуй, 2 основных библиотеки для работы с изображениями в <code class="docutils literal notranslate"><span class="pre">python</span></code>.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pillow.readthedocs.io/en/stable/index.html">Pillow</a> позволяет загружать, выводить на экран, редактировать и сохранять изображения;</p></li>
<li><p><a class="reference external" href="https://docs.opencv.org/4.x/index.html">openCV</a> — полноценный фреймворк для обработки изображений.</p></li>
</ul>
<p>Стоит упомянуть, что</p>
<ul class="simple">
<li><p>загрузить, вывести и сохранить изображение можно также средствами библиотеки <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>;</p></li>
<li><p>часть функционала по обработке изображений можно найти в библиотеке <code class="docutils literal notranslate"><span class="pre">scipy</span></code> в общем, и в модуле <a class="reference external" href="https://scipy.github.io/devdocs/reference/ndimage.html">scipy.ndimage</a></p></li>
<li><p>существует библиотека-аналог для <code class="docutils literal notranslate"><span class="pre">openCV</span></code> — <a class="reference external" href="https://scikit-image.org/">scikit-image</a>.</p></li>
</ul>
<p>В ячейке ниже импортируются необходимые библиотеки (<code class="docutils literal notranslate"><span class="pre">cv2</span></code> соответствует <code class="docutils literal notranslate"><span class="pre">openCV</span></code>), а также определяется функция для красивого вывода изображения в заданных осях, которая будет использоваться всюду далее.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import os

import numpy as np
from matplotlib import pyplot as plt
import PIL
import cv2


image_folder = os.path.join(&quot;..&quot;, &quot;..&quot;, &quot;_static&quot;, &quot;lecture_specific&quot;, &quot;cv&quot;)


def show_image(ax, image, title=None, cmap=None):
    &quot;&quot;&quot;
    Вывести изображение в указанных осях.
    &quot;&quot;&quot;
    ax.imshow(image, cmap=cmap)
    ax.set_title(title)
    ax.xaxis.set_visible(False)
    ax.yaxis.set_visible(False)
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h2>Изображения в оттенках серого<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<section id="id3">
<h3>Чтение с диска<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<p>Загрузить изображение, например, с диска можно</p>
<ul class="simple">
<li><p>методом <a class="reference external" href="https://docs.opencv.org/4.x/d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv2.imread</a> — возвращает массив <code class="docutils literal notranslate"><span class="pre">numpy</span></code>;</p></li>
<li><p>методом <a class="reference external" href="https://matplotlib.org/3.5.1/api/_as_gen/matplotlib.pyplot.imread.html">plt.imread</a> — возвращает массив <code class="docutils literal notranslate"><span class="pre">numpy</span></code>;</p></li>
<li><p>методом <a class="reference external" href="https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.open">PIL.Image.open</a> — возвращает экземпляр класса <a class="reference external" href="https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.Image">PIL.Image.Image</a>, который можно преобразовать к массиву <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, передав его в качестве аргумента методу <code class="docutils literal notranslate"><span class="pre">numpy.array</span></code>.</p></li>
</ul>
<p>Начнем с черно-белых изображений, а если быть точнее — изображений в оттенках серого.</p>
<p>Ниже приводится пример того, как можно загрузить изображения, используя вышеперечисленные методы.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>path = os.path.join(image_folder, &quot;gray.jpg&quot;)


images = {
    &quot;openCV&quot;: cv2.imread(path, cv2.IMREAD_GRAYSCALE),
    &quot;matplotlib&quot;: plt.imread(path),
    &quot;Pillow&quot;: np.array(PIL.Image.open(path))
}


for library, image in images.items():
    print(f&quot;{library:10}: shape={image.shape}, dtype={image.dtype}&quot;)    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>openCV    : shape=(512, 512), dtype=uint8
matplotlib: shape=(512, 512), dtype=uint8
Pillow    : shape=(512, 512), dtype=uint8
</pre></div>
</div>
</div>
</div>
<p>Видим, что все массивы одинаковой формы (512, 512) с 8-битным беззнаковым целочисленным типом данных.</p>
<ul class="simple">
<li><p>форма массива (512, 512) соответствует <a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_(%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%8F_%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%BA%D0%B0)">разрешению изображения</a>;</p></li>
<li><p>количество бит, которое используется для представления цвета при кодировании изображения, называют <a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%93%D0%BB%D1%83%D0%B1%D0%B8%D0%BD%D0%B0_%D1%86%D0%B2%D0%B5%D1%82%D0%B0">глубинной цвета</a>. Данное изображение имеет глубину цвета 8 бит, т.е. цвет каждого пикселя кодируется числом в диапазоне от 0 до 255, где 0 соответствует черному цвету, 255 соответствует белому цвету, а все промежуточные цвета — оттенкам серого.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Для хранения изображений обычно используются целочисленные яркости с разной глубинной цвета, но при обработке изображений яркости пикселей чаще представляют действительными числами в диапазоне от 0 до 1 из-за более адекватной арифметики.</p>
</div>
<p>Проверим, содержат ли массивы, считанные всеми библиотекам, одинаковые значения.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from itertools import combinations


def L1_distance(x, y):
    return np.abs(x - y).sum()


for (lib1, image1), (lib2, image2) in combinations(images.items(), 2):
    diff = L1_distance(image1, image2)
    print(f&quot;{lib1:10} and {lib2:10}: {diff}&quot;)

image = images[&quot;openCV&quot;]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>openCV     and matplotlib: 0
openCV     and Pillow    : 0
matplotlib and Pillow    : 0
</pre></div>
</div>
</div>
</div>
<p>Видим, что все три библиотеки считали абсолютно одинаковые массивы.</p>
<p>Выясним, в каком диапазоне элементы массива принимают значения.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(f&quot;Элементы массива принимают значения в диапазоне от {image.min()} до {image.max()}.&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Тип данных uint8.
Элементы массива принимают значения в диапазоне от 19 до 246.
</pre></div>
</div>
</div>
</div>
<p>Т.е. самый темный пиксель этого изображения имеет яркость 19, а самый яркий 246. Абсолютно черных и белых пикселей в этом изображении нет.</p>
<p>Выведем это изображение средствами <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(figsize=(5, 5), layout=&quot;tight&quot;)
show_image(ax, image, title=&quot;matplotlib&quot;, cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_9_0.png" src="../../_images/basics_9_0.png" />
</div>
</div>
<p>Библиотека <code class="docutils literal notranslate"><span class="pre">openCV</span></code> тоже умеет выводить изображения, но для этого создаёт отдельное окно. Изображения библиотеки <code class="docutils literal notranslate"><span class="pre">PIL</span></code> можно выводить в <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code> непосредственно.</p>
<p>Т.к. мы уже поняли, что <code class="docutils literal notranslate"><span class="pre">cv2_image</span></code>, <code class="docutils literal notranslate"><span class="pre">pil_image</span></code> и <code class="docutils literal notranslate"><span class="pre">plt_image</span></code> в точности совпадают, то заведем две новые переменные, которые пригодятся в будущем.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">image</span></code> — изображение, считанное библиотекой <code class="docutils literal notranslate"><span class="pre">Pillow</span></code> (экземпляр класса <code class="docutils literal notranslate"><span class="pre">PIL.Image.Image</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">array</span></code> — его представление в виде массива <code class="docutils literal notranslate"><span class="pre">numpy</span></code>;</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>image = PIL.Image.open(path)
array = np.array(image)

image
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_11_0.png" src="../../_images/basics_11_0.png" />
</div>
</div>
</section>
<section id="id4">
<h3>Яркости пикселей<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<p>Т.к. изображение представляется в виде массива, то над ним можно производить математические операции.</p>
<p>Прибавим к изображению константу, что выйдет.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>c = 40

fig, axs = plt.subplots(figsize=(12, 4), ncols=3, layout=&quot;tight&quot;)
show_image(axs[0], np.sin(array/255. * np.pi / 2), title=f&quot;image - {c}&quot;, cmap=&quot;gray&quot;)
show_image(axs[1], array, title=&quot;image&quot;, cmap=&quot;gray&quot;)
show_image(axs[2], array+c, title=f&quot;image + {c}&quot;, cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_13_0.png" src="../../_images/basics_13_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Т.к. массив хранит яркости пикселей, то прибавляя положительную константу, мы увеличиваем яркости всех пикселей на неё и получаем более яркое (светлое изображение).</p></li>
<li><p>Т.к. для яркости каждого пикселя используется всего 8 бит, то возможно переполнение, т.е. очень яркие пиксели могут сдвинуться в темную область.</p></li>
</ul>
<p>В качестве демонстрации создадим матрицу следующего вида и выведем её в качестве изображения.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix}
0 &amp; 0 &amp; 0 &amp; \cdots &amp; 0\\
1 &amp; 1 &amp; 1 &amp; \cdots &amp; 1\\
2 &amp; 2 &amp; 2 &amp; \cdots &amp; 2\\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
255 &amp; 255 &amp; 255 &amp; \cdots &amp; 255
\end{pmatrix}.
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>math_array = np.ones(shape=(1, 256), dtype=np.uint8) * np.arange(256, dtype=np.uint8).reshape(256, 1) 

fig, ax = plt.subplots(figsize=(4, 4), layout=&quot;tight&quot;)
show_image(ax, math_array, cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_15_0.png" src="../../_images/basics_15_0.png" />
</div>
</div>
<p>Инвертировать изображение можно вычесть его из 255.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, axs = plt.subplots(figsize=(8, 4), ncols=2, layout=&quot;tight&quot;)
show_image(axs[0], math_array, title=&quot;image&quot;, cmap=&quot;gray&quot;)
show_image(axs[1], 255 - math_array, title=f&quot;255 - image&quot;, cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_17_0.png" src="../../_images/basics_17_0.png" />
</div>
</div>
</section>
<section id="id5">
<h3>Манипуляции на формой массива<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<p>Чтобы обрезать изображения, можно использовать срезы.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>H, W = array.shape
h, w = H // 2, W // 2

top_left = array[:h, :w]
top_right = array[:h, w:]
bottom_left = array[h:, :w]
bottom_right = array[h:, w:]

fig, axs = plt.subplots(figsize=(10, 10), nrows=2, ncols=2, layout=&quot;tight&quot;)
show_image(axs[0, 0], top_left, cmap=&quot;gray&quot;)
show_image(axs[0, 1], top_right, cmap=&quot;gray&quot;)
show_image(axs[1, 0], bottom_left, cmap=&quot;gray&quot;)
show_image(axs[1, 1], bottom_right, cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_19_0.png" src="../../_images/basics_19_0.png" />
</div>
</div>
<p>Аналогично, можно отразить изображение по вертикали, горизонтали и т.д.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>hor_flip = array[:, ::-1]
vert_flip = array[::-1, :]
both = array[::-1, ::-1]


fig, axs = plt.subplots(figsize=(10, 10), nrows=2, ncols=2, layout=&quot;tight&quot;)
show_image(axs[0, 0], array, cmap=&quot;gray&quot;)
show_image(axs[0, 1], hor_flip, cmap=&quot;gray&quot;)
show_image(axs[1, 0], vert_flip, cmap=&quot;gray&quot;)
show_image(axs[1, 1], both, cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_21_0.png" src="../../_images/basics_21_0.png" />
</div>
</div>
<p>Чтобы повернуть изображение на угол кратный <span class="math notranslate nohighlight">\(90^\circ\)</span>, можно использовать метод <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.rot90.html">np.rot90</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, axs = plt.subplots(figsize=(10, 10), nrows=2, ncols=2, layout=&quot;tight&quot;)
show_image(axs[0, 0], array, cmap=&quot;gray&quot;)
show_image(axs[0, 1], np.rot90(array, 1), cmap=&quot;gray&quot;)
show_image(axs[1, 1], np.rot90(array, 2), cmap=&quot;gray&quot;)
show_image(axs[1, 0], np.rot90(array, 3), cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_23_0.png" src="../../_images/basics_23_0.png" />
</div>
</div>
</section>
<section id="id6">
<h3>Поворот на произвольный угол<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h3>
<p>Чтобы повернуть изображение на произвольный угол, необходимо интерполировать значения в узлах новой решетки.</p>
<p><code class="docutils literal notranslate"><span class="pre">Pillow</span></code> позволяет вращать изображения методом <a class="reference external" href="https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.Image.rotate">rotate</a> класса <code class="docutils literal notranslate"><span class="pre">PIL.Image.Image</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>image.rotate(45, expand=False, fillcolor=PIL.Image.NEAREST)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_25_0.png" src="../../_images/basics_25_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">openCV</span></code> имеет чуть более общий интерфейс и позволяет применять аффинное преобразование к изображению, частным случаям которого является поворот изображения вокруг выбранной точки.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>rotation_center = (h, w)
rotation_angle = 45
scale = 1.0
rotation_matrix = cv2.getRotationMatrix2D(rotation_center, rotation_angle, scale)

rotated_image = cv2.warpAffine(array, rotation_matrix, dsize=(H, W))

fig, axs = plt.subplots(figsize=(10, 10), ncols=2, layout=&quot;tight&quot;)
show_image(axs[0], array, cmap=&quot;gray&quot;)
show_image(axs[1], rotated_image, cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_27_0.png" src="../../_images/basics_27_0.png" />
</div>
</div>
</section>
</section>
<section id="id7">
<h2>Цветные изображения<a class="headerlink" href="#id7" title="Permalink to this headline">#</a></h2>
<p>Всё, что мы перечислили для изображений в оттенках серого, работает аналогично и для цветных изображений, но по каналам.</p>
<p>Все перечисленные методы чтения изображений отработают и для цветных изображений.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>path = os.path.join(image_folder, &quot;lena.jpg&quot;)

images = {
    &quot;openCV&quot;: cv2.imread(path),
    &quot;matplotlib&quot;: plt.imread(path),
    &quot;Pillow&quot;: np.array(PIL.Image.open(path))
}


for library, image in images.items():
    print(f&quot;{library:10}: shape={image.shape}, dtype={image.dtype}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>openCV    : shape=(512, 512, 3), dtype=uint8
matplotlib: shape=(512, 512, 3), dtype=uint8
Pillow    : shape=(512, 512, 3), dtype=uint8
</pre></div>
</div>
</div>
</div>
<p>Получаем массив формы <span class="math notranslate nohighlight">\(512\times512\times3\)</span>, где 3 соответствует трём каналам: красный, зеленый и голубой. Но даже здесь есть один подвох. Выведем три получившихся массива.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, axs = plt.subplots(figsize=(12, 4), ncols=3, layout=&quot;tight&quot;)

for i, lib in enumerate(images):
    show_image(axs[i], images[lib], title=lib)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_31_0.png" src="../../_images/basics_31_0.png" />
</div>
</div>
<p>Изображение, считанной библиотекой выглядит странно. Дело в том, что</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> и <code class="docutils literal notranslate"><span class="pre">Pillow</span></code> хранят изображения в формате <code class="docutils literal notranslate"><span class="pre">RGB</span></code>, т.е. первый канал изображения соответствует красному, второй зеленому, а третий синему.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">openCV</span></code> хранит изображения в формате <code class="docutils literal notranslate"><span class="pre">GBR</span></code>, т.е. красный и зеленый поменяны местами.</p></li>
</ul>
<p>Для вывода изображения мы использовали метод библиотеки <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, который ожидает изображения в формате <code class="docutils literal notranslate"><span class="pre">RGB</span></code>, а в случае с изображением, считанным библиотекой <code class="docutils literal notranslate"><span class="pre">openCV</span></code>, получает <code class="docutils literal notranslate"><span class="pre">BGR</span></code> изображение.</p>
<p>Чтобы нагляднее это проиллюстрировать, проделаем то же самое на изображении из базовых цветов.</p>
<figure class="align-default">
<img alt="../../_images/colors.png" src="../../_images/colors.png" />
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>path = os.path.join(image_folder, &quot;colors.png&quot;)

cv2_image = cv2.imread(path)
plt_image = plt.imread(path)

fig, axs = plt.subplots(figsize=(10, 5), ncols=2, layout=&quot;tight&quot;)

show_image(axs[0], plt_image, title=&quot;matplotlib&quot;)
show_image(axs[1], cv2_image, title=&quot;openCV&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_33_0.png" src="../../_images/basics_33_0.png" />
</div>
</div>
<p>Видим, что левое изображение выглядит также, как и должно, а на правом</p>
<ul class="simple">
<li><p>красное поменялось местами с синим;</p></li>
<li><p>желтое (смесь красного и зеленого) поменялось местами с голубым (смесь синего и зеленого).</p></li>
</ul>
<p>Ниже определяются функции, которые выводят само изображения и все его каналы по очереди.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def show_channel(ax, image, channel, color=True):
    if color:
        to_show = np.zeros_like(image)
        to_show[..., channel] = image[..., channel]
        show_image(ax, to_show, title=f&quot;channel:{channel}&quot;)
    else:
        to_show = image[..., channel]
        show_image(ax, to_show, cmap=&quot;gray&quot;, title=f&quot;channel:{channel}&quot;)
        
        
    
def show_channels(image, title, color=True):
    fig, axs = plt.subplots(figsize=(12, 3), ncols=4, layout=&quot;tight&quot;)
    fig.suptitle(title)
    
    show_image(axs[0], image, title=&quot;all channels&quot;)
    for i in range(3): 
        show_channel(axs[i + 1], image, i, color=color)
</pre></div>
</div>
</div>
</div>
<p>Выведем каналы изображений. Т.к. один канал — это двухмерная матрица, то его можно считать изображением в оттенках серого: чем больше значение в этом канале, тем ярче белее пиксель.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>show_channels(cv2_image, &quot;openCV&quot;, False)
show_channels(plt_image, &quot;matplotlib&quot;, False)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_37_0.png" src="../../_images/basics_37_0.png" />
<img alt="../../_images/basics_37_1.png" src="../../_images/basics_37_1.png" />
</div>
</div>
<p>Здесь отчетливо видно, что в <code class="docutils literal notranslate"><span class="pre">openCV</span></code> первый и третий канал перепутаны местами.</p>
<p>Библиотека <code class="docutils literal notranslate"><span class="pre">openCV</span></code> позволяет преобразовать изображение из одной цветовой схемы в другую методом <a class="reference external" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv2.cvtColor</a>. В частности, этим методом можно из <code class="docutils literal notranslate"><span class="pre">GBR</span></code> перейти в <code class="docutils literal notranslate"><span class="pre">RGB</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cv2_image = cv2.cvtColor(cv2_image, cv2.COLOR_BGR2RGB)

fig, axs = plt.subplots(figsize=(10, 5), ncols=2, layout=&quot;tight&quot;)
show_image(axs[0], plt_image, title=&quot;matplotlib&quot;)
show_image(axs[1], cv2_image, title=&quot;openCV&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_39_0.png" src="../../_images/basics_39_0.png" />
</div>
</div>
<p>Чтобы получше прочувствовать, то как комбинируются цвета из палитры <code class="docutils literal notranslate"><span class="pre">RGB</span></code>, выведем те же каналы, но в цвете.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>show_channels(plt_image, &quot;matplotlib&quot;, True)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_41_0.png" src="../../_images/basics_41_0.png" />
</div>
</div>
<ul class="simple">
<li><p>белый — максимальная яркость всех каналов;</p></li>
<li><p>черный — нулевая яркость всех каналов;</p></li>
<li><p>серый — средняя яркость всех каналов;</p></li>
<li><p>красный, зеленый и синий — максимальная яркость в одном из каналов, и нулевая в остальных;</p></li>
<li><p>голубой, фиолетовый и желтый — аддитивные комбинации двух из базовых цветов.</p></li>
</ul>
<p>Как получить из цветного изображение черно-белое? Чтобы это сделать, необходимо от трехканального изображения, перейти к двухканальному.</p>
<p>Самый наивный способ: просто сложить все каналы. Сложим все каналы, но перед этим поделим массив на число с плавающей точкой 255, чтобы уйти от ограничений целочисленной арифметики. Все современные библиотеки работы с изображениями позволяют задавать яркость как целыми числом, так и действительным числом от 0 до 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>path = os.path.join(image_folder, &quot;drop.jpg&quot;)
image = plt.imread(path) / 255. 
grayscale = image.mean(axis=2)

fig, axs = plt.subplots(figsize=(10, 5), ncols=2, layout=&quot;tight&quot;)
show_image(axs[0], image, title=&quot;color&quot;)
show_image(axs[1], grayscale, cmap=&quot;gray&quot;, title=&quot;(R + G + B)/3&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_44_0.png" src="../../_images/basics_44_0.png" />
</div>
</div>
<p>На самом деле известно, что разные цвета не дают одинаковый вклад в общую яркость, поэтому лучше, например, складывать каналы с коэффициентами</p>
<ul class="simple">
<li><p>0.222 для красного канала;</p></li>
<li><p>0.666 для зеленого калана;</p></li>
<li><p>0.111 для синего канала.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>weights = (0.222, 0.666, 0.111)
grayscale = sum(weights[i] * image[..., i] for i in range(3))

fig, axs = plt.subplots(figsize=(10, 5), ncols=2, layout=&quot;tight&quot;)
show_image(axs[0], image, title=&quot;color&quot;)
show_image(axs[1], grayscale, cmap=&quot;gray&quot;, title=f&quot;{weights[0]}*R + {weights[1]}*G + {weights[2]}*B&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_46_0.png" src="../../_images/basics_46_0.png" />
</div>
</div>
<p>Есть ещё более сложные формулы, которые дают ещё лучший результат.</p>
<p>Преобразовать цветное изображение в черно-белом можно все тем же методом <code class="docutils literal notranslate"><span class="pre">cv2.cvtColor</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>image = plt.imread(path)
grayscale = cv2.cvtColor(image, cv2.COLOR_RGB2GRAY)

fig, axs = plt.subplots(figsize=(10, 5), ncols=2, layout=&quot;tight&quot;)
show_image(axs[0], image, title=&quot;color&quot;)
show_image(axs[1], grayscale, cmap=&quot;gray&quot;, title=f&quot;cv2.COLOR_RGB2GRAY&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_48_0.png" src="../../_images/basics_48_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RGB</span></code> — не единственный способ, представлять цветные изображения. В ряде задач удобнее использовать другие палитры.</p>
<p>Рассмотрим палитру <a class="reference external" href="https://en.wikipedia.org/wiki/HSL_and_HSV">Hue-Saturation-Value</a>. В ней <code class="docutils literal notranslate"><span class="pre">Hue</span></code> отвечает за сам цвет, <code class="docutils literal notranslate"><span class="pre">Saturation</span></code> — за насыщенность этого цвета, а <code class="docutils literal notranslate"><span class="pre">Value</span></code> за яркость.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>path = os.path.join(image_folder, &quot;rose.jpg&quot;)
image = plt.imread(path)

hsv_image = cv2.cvtColor(image, cv2.COLOR_RGB2HSV)
show_channels(image, &quot;Hue-Saturation-Value&quot;, False)
show_channels(hsv_image, &quot;Hue-Saturation-Value&quot;, False)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_50_0.png" src="../../_images/basics_50_0.png" />
<img alt="../../_images/basics_50_1.png" src="../../_images/basics_50_1.png" />
</div>
</div>
<p>В  пространстве гораздо удобнее производить операции над цветом изображения, т.к. именно за цвет отвечает канал <code class="docutils literal notranslate"><span class="pre">hue</span></code>.</p>
<figure class="align-default">
<img alt="../../_images/hsv_cylinder.png" src="../../_images/hsv_cylinder.png" />
</figure>
<p>Например, оттенки красного цвета имеют <code class="docutils literal notranslate"><span class="pre">hue</span></code> в диапазоне приблизительно от 155 до 179. Найдем <a class="reference external" href="https://en.wikipedia.org/wiki/Mask_(computing)">маску</a>, соответствующую пикселям красного цвета.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>lower_red = 155
upper_red = 179
hue = hsv_image[..., 0]

hue_mask =  (lower_red &lt;= hue) &amp; (hue &lt;= upper_red) 
hue_mask = np.expand_dims(hue_mask, axis=2)
masked_image = hue_mask * image

fig, axs = plt.subplots(figsize=(10, 5), ncols=2, layout=&quot;tight&quot;)
show_image(axs[0], hue_mask, cmap=&quot;gray&quot;)
show_image(axs[1], masked_image)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_52_0.png" src="../../_images/basics_52_0.png" />
</div>
</div>
<p>Даже такой простой способ позволил неплохо выделить весь красный цвета на изображении, но зацепил и белый, т.к. белый цвет можно представить в качестве красного с очень низкой насыщенностью. Отфильтруем белый цвет ещё одной маской по каналу насыщенности.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>upper_white = 19
saturation = hsv_image[..., 1]

saturation_mask = (saturation &gt;= upper_white)
saturation_mask = np.expand_dims(saturation_mask, axis=2)
mask = (hue_mask &amp; saturation_mask)
masked_image = mask * image

fig, axs = plt.subplots(figsize=(10, 5), ncols=2, layout=&quot;tight&quot;)
show_image(axs[0], mask, cmap=&quot;gray&quot;)
show_image(axs[1], masked_image)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_54_0.png" src="../../_images/basics_54_0.png" />
</div>
</div>
<p>Такая маска очень хорошо вырезает розу без лишних элементов. Далее она может быть использована для того, чтобы, например, вырезать розу с этого изображения и вставить её в другое.</p>
<p>Сделаем на основе этой маски изображение цветное внутри маски и черно-белое снаружи.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gray = cv2.cvtColor(image, cv2.COLOR_RGB2GRAY)
gray = cv2.cvtColor(gray, cv2.COLOR_GRAY2RGB)

red_gray_image = mask * image + ~mask * gray 
fig, ax = plt.subplots(figsize=(10, 5), layout=&quot;tight&quot;)
show_image(ax, red_gray_image, cmap=&quot;gray&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/basics_56_0.png" src="../../_images/basics_56_0.png" />
</div>
</div>
<p>Код в ячейке ниже позволяет продемонстрировать влияние параметра <code class="docutils literal notranslate"><span class="pre">hue</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from IPython.display import display
from ipywidgets import interact
import ipywidgets as widgets

image = red_gray_image 
hsv_image = cv2.cvtColor(image, cv2.COLOR_RGB2HSV)

def plot_histograms(ax, image):
    colors = (&#39;b&#39;,&#39;g&#39;,&#39;r&#39;)
    for i, color in enumerate(colors):
        hist = cv2.calcHist([image], [i], None, [256], [0,256])
        ax.plot(hist, color=color)
    

def interact_hsv(hue=0):
    fig, axs = plt.subplots(figsize=(12, 5), ncols=2, layout=&quot;tight&quot;)
    delta = np.array([[[hue, 0, 0]]], dtype=np.uint8)
    image = cv2.cvtColor(hsv_image + delta, cv2.COLOR_HSV2RGB)
    show_image(axs[0], image)
    
    axs[1].set_xlim([0, 255])
    axs[1].set_ylim([0, 5000])
    plot_histograms(axs[1], image)

_ = interact(interact_hsv,
         hue=widgets.IntSlider(min=0, max=255, value=200, step=5),
)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "7138cb80be084613ba7fae559140a389", "version_major": 2, "version_minor": 0}
</script></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks\computer_vision"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../python/about_12_and_so_on.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">О последних лекциях</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="filters.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Свёрточные операции</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Fadeev Egor<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>